# Maintainer: nalla <nalla@hamal.uberspace.de>

pkgname=('git-extra')
_ver_base=1.0
pkgver=1.0.34.190438b
pkgrel=1
pkgdesc="Git for Windows extra files"
arch=('i686' 'x86_64')
url="https://github.com/git-for-windows/build-extra"
license=('GPL')
groups=('VCS')
depends=('vim')
source=(
  '..\\vimrc'
  '..\\vi'
  '..\\nsswitch.conf'
  '..\\gitconfig'
  '..\\profile.d\\git.sh'
  '..\\profile.d\\aliases.sh'
)
md5sums=(
  'SKIP'
  'SKIP'
  'SKIP'
  'SKIP'
  'SKIP'
  'SKIP'
)
install='git-extra.install'
pkgver() {
  printf "%s.%s.%s" "${_ver_base}" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  printf '%s\n%s\n%s\n%s\n%s\n%s\n%s\n%s\n%s\n%s\n' \
    "export LC_ALL=C" \
    "post_install () {" \
    "for dir in mingw32 mingw64; do test ! -d /\$dir || test -f /\$dir/etc/gitconfig || cat > /\$dir/etc/gitconfig <<\\GITCONFIG; done" \
    "$(cat $srcdir/gitconfig)" \
    "GITCONFIG" \
    "grep -q '^db_home: windows' /etc/nsswitch.conf || cat > /etc/nsswitch.conf <<\\NSSWITCH" \
    "$(cat $srcdir/nsswitch.conf)" \
    "NSSWITCH" \
    "}" \
    "post_upgrade () {" \
    "    post_install" \
    "}" > $startdir/$pkgname.install
}

package() {
  install -d -m755 $pkgdir/etc/profile.d
  install -d -m755 $pkgdir/usr/bin
  install -m755 $srcdir/vimrc $pkgdir/etc
  install -m755 $srcdir/vi $pkgdir/usr/bin
  install -m755 $srcdir/git.sh $pkgdir/etc/profile.d
  install -m755 $srcdir/aliases.sh $pkgdir/etc/profile.d
}
